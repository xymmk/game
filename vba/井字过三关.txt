Dim rightH
Dim leftH
Dim upD
Dim downD
Dim rightN
Dim leftN

'右プラス
Sub rightHSum(n, m, num)

    If rightH < 3 Then
        j = m + 1
        If j >= 1 And j <= 3 Then
            If Sheet1.Cells(n, m) = Sheet1.Cells(n, j) And Sheet1.Cells(n, m) <> 0 Then
                rightH = num + 1
                Call rightHSum(n, j, rightH)
            Else
                Exit Sub
            End If
        Else
            Exit Sub
        End If
    Else
        Exit Sub
    End If
End Sub

'左プラス
Sub leftHSum(n, m, num)

    If leftH < 3 Then
        j = m - 1
        If j >= 1 And j <= 3 Then
            If Sheet1.Cells(n, m) = Sheet1.Cells(n, j) And Sheet1.Cells(n, m) <> 0 Then
                leftH = num + 1
                Call leftHSum(n, j, leftH)
            Else
                Exit Sub
            End If
        Else
            Exit Sub
        End If
    Else
        Exit Sub
    End If
End Sub

'下プラス
Sub downDSum(n, m, num)

    If downD < 3 Then
        j = n + 1
        If j >= 1 And j <= 3 Then
            If Sheet1.Cells(n, m) = Sheet1.Cells(j, m) And Sheet1.Cells(n, m) <> 0 Then
                downD = num + 1
                Call downDSum(j, m, downD)
            Else
                Exit Sub
            End If
        Else
            Exit Sub
        End If
    Else
        Exit Sub
    End If
End Sub

'上プラス
Sub upDSum(n, m, num)

    If upD < 3 Then
        j = n - 1
        If j >= 1 And j <= 3 Then
            If Sheet1.Cells(n, m) = Sheet1.Cells(j, m) And Sheet1.Cells(n, m) <> 0 Then
                upD = num + 1
                Call upDSum(j, m, num)
            Else
                Exit Sub
            End If
        Else
            Exit Sub
        End If
    Else
        Exit Sub
    End If
End Sub


'右斜め
Sub rightNSum(n, m, num)

    If rightN < 3 Then
        i = n + 1
        j = m + 1
        If i >= 1 And i <= 3 Then
            If j >= 1 And j <= 3 Then
                If Sheet1.Cells(n, m) = Sheet1.Cells(i, j) And Sheet1.Cells(n, m) <> 0 Then
                    rightN = num + 1
                    Call rightNSum(i, j, rightN)
                Else
                    Exit Sub
                End If
            Else
                Exit Sub
            End If
        Else
            Exit Sub
        End If
    Else
        Exit Sub
    End If

End Sub

'左斜め
Sub leftNSum(n, m, num)
        
    If leftN < 3 Then
        i = n + 1
        j = m - 1
        If i >= 1 And i <= 3 Then
            If j >= 1 And j <= 3 Then
                If Sheet1.Cells(n, m) = Sheet1.Cells(i, j) And Sheet1.Cells(n, m) <> 0 Then
                    leftN = num + 1
                    Call leftNSum(i, j, leftN)
                Else
                    Exit Sub
                End If
            Else
                Exit Sub
            End If
        Else
            Exit Sub
        End If
    Else
        Exit Sub
    End If
End Sub

Function checkBlank()

    For i = 1 To 3 Step 1
        For j = 1 To 3 Step 1
            If Sheet1.Cells(i, j) = 0 Then
                checkBlank = 1
                Exit Function
            End If
        Next
    Next
    Exit Function
    
End Function

Function checkValue()
        For i = 1 To 3 Step 1
        For j = 1 To 3 Step 1
            If Sheet1.Cells(i, j) = 0 Or Sheet1.Cells(i, j) = 1 Or Sheet1.Cells(i, j) = 2 Then
                checkValue = 1
            Else
                checkValue = 2
                Exit Function
            End If
        Next
    Next
End Function



Sub init()
    downD = 0
    upD = 0
    rightH = 0
    leftH = 0
    For i = 1 To 3 Step 1
        For j = 1 To 3 Step 1
            Sheet1.Cells(i, j) = 0
        Next j
    Next i
End Sub

Private Sub CommandButton1_Click()
    Call init
    'Application.EnableEvents = True
    'Application.ScreenUpdating = True
End Sub


Private Sub Worksheet_SelectionChange(ByVal Target As Range)
    downD = 0
    upD = 0
    rightH = 0
    leftH = 0
    rightN = 0
    leftN = 0
    For i = 1 To 3 Step 1
        For j = 1 To 3 Step 1
            Call rightHSum(i, j, 1)
            Call leftHSum(i, j, 1)
            Call upDSum(i, j, 1)
            Call downDSum(i, j, 1)
            Call leftNSum(i, j, 1)
            Call rightNSum(i, j, 1)
        Next j
    Next i
    
    flag = checkBlank
    
    If rightH = 3 Or leftH = 3 Or upD = 3 Or downD = 3 Or leftN = 3 Or rightN = 3 Then
        over = 1
        MsgBox "rightH: " & rightH & "leftH: " & leftH & "upD: " & upD & "downD: " & downD & " rightN " & rightN & " leftN " & leftN
    End If
    
    If flag <> 1 And over <> 1 Then
        MsgBox "no win"
    End If
    
    flag = checkValue
    
    If checkValue = 2 Then
        MsgBox "you wrong"
    End If
End Sub
